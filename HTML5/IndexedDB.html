<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>IndexDB</title>
        <style media="screen">
            body,input{
                font-family: 'Raleway',sans-serif;
            }
            body{
                margin: 88px 120px 0;
            }
        </style>
    </head>
    <body>
        <button id="button" type="button" name="button">Add Song to Playlist.</button>
        <script type="text/javascript">

            let database;

            window.onload = function() {
                let req = window.indexedDB.open("OurPlaylistDB",1);

                req.onsuccess = function() {
                    database = req.result;
                }
                req.onerror = function(event){
                    alert("There is an error:",event);
                }

                req.onupgradeneeded = function(event) {
                    let db = req.result;
                    let objectStore = db.createObjectStore("Songs", {
                        keypath:"id" ,autoIncrement : true
                    });
                }

                function Song(name,artist) {
                    this.name = name;
                    this.artist = artist;
                }


                function addSong(song,success,error) {
                    let transaction = database.transaction(["Songs"],"readwrite");
                    let objectStore = transaction.objectStore("Songs");

                    let request = objectStore.add(song);
                    request.onerror = error;
                    request.onsuccess = success;
                }

                document.getElementById('button').addEventListener("click",function(){
                    let mySong = new Song("Pumped Up","Foster The people");
                    addSong(mySong,function()
                    {
                        readSongs(
                        function(songs){
                            console.log(songs);
                        },
                        function(error)
                        {
                            console.log("Error in reading songs");
                        });
                    },function(){
                        console.log("Error");
                    })
                });
                // CRUD Create,Read,Update& Delete.

                function readSongs(success,error) {
                    let transaction = database.transaction(["Songs"],"readonly");
                    let objectStore = transaction.objectStore("Songs");

                    let request = objectStore.openCursor();

                    request.error = error;

                    let songs = [];

                    request.onsuccess = function(event) {
                        let cursor = event.target.result;
                        if (cursor) {
                            let song = cursor.value;
                            songs.push(song);
                            cursor.continue();
                        }
                        else{
                            success(songs);
                        }
                    }
                }
            }
        </script>
    </body>
</html>
